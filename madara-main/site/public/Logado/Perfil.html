<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/Perfil.css">
    <script src="../js/funcoes.js"></script>


    <title>Document</title>
</head>

<body>
    <div class="social" id="parte1" style="display: block;">
        <h1 id="tituloPerfil">Sorteio de imagem de perfil</h1>
        Sorteie sua foto de perfil !!, qual fase do madara voce seria ?
        Você só tera 1 chance de sorteio<button onclick="analisar()">Sortear</button>
        <div class="banner">
            <div class="hello">
                <h3>Bem vindo, <span id="b_usuario">usuário</span>!</h3>
                <span id="frasetest"></span>
            </div>
        </div>
        <div class="container">
            <ul>
                <li><a href="#img1"> <img src="../Assets/madara-kid.png" class="foto"></a></li>
                <li><a href="#img2"> <img src="../Assets/madara-edo.png" class="foto"></a></li>
                <li><a href="#img3"> <img src="../Assets/madara-caolho.jpg" class="foto"></a></li>
                <li><a href="#img4"> <img src="../Assets/morte.jpg" class="foto"></a></li>
                <li><a href="#img5"> <img src="../Assets/rinnegan.jpeg" class="foto"></a></li>
                <li><a href="#img6"> <img src="../Assets/LOUCO.png" class="foto"></a></li>
                <li><a href="#img7"> <img src="../Assets/madara-folha.jpg" class="foto"></a></li>
                <li><a href="#img8"> <img src="../Assets/madara-guerra.jpg" class="foto"></a></li>
                <li><a href="#img9"> <img src="../Assets/só-madara.jpg" class="foto"></a></li>
            </ul>
        </div>
        
    </div>

    <div class="social2" id="parte2" style="display: none;">
        <div class="header">
            <div class="container">
                <li id="logo">Uchiha Madara</li>
                <div class="navbar">
                    <li><a href="../index.html">Inicio</a></li>
                    <li><a href="../Batalhas.html">Batalhas</a></li>
                    <li id="logado" style="display: none;"><a href="../Logado/Grafico.html">grafico</a></li>
                    <li><a href="galeria.html">Galeria</a></li>
                    <li id="logado" style="display: none;"><a href="../Logado/Quiz-madara.html">Quiz</a></li>
                    <li id="deslogado" style="display: block;"><a href="Login-Madara.html">Login</a></li>
                    <li id="deslogado" style="display: block;"><a href="Cadastrar-Madara.html">Cadastrar</a></li>
                    <li onclick="sair()"><a href="../Login-Madara.html">Sair</a></li>
                </div>
            </div>
        </div>
        <div class="container2">
            <h3>Bem vindo, <span id="a_usuario">usuário</span>!</h3>
            <h1>Perfil</h1>
            <div class="legenda">
                <span id="suafoto"></span>
                <ul>
                    <li>Nome:<span id="nome"></span></li>
                    <li>Email:<span id="email"></span></li>
                </ul>
            </div>
        </div>
    </div>

</body>

</html>
<script>

    if (sessionStorage.length == 0) {

    } else {
        logado[0].style.display = 'block';
        logado[1].style.display = 'block';
        deslogado[0].style.display = 'none';
        deslogado[1].style.display = 'none';
    }
    function sair(){
        sessionStorage.clear()
    }

    foto_fixa = sessionStorage.FOTO_USUARIO
    nome.innerHTML = sessionStorage.NOME_USUARIO
    email.innerHTML = sessionStorage.EMAIL_USUARIO



    var linkFoto = "a"
    function analisar() {

        var sorteio = (Math.random() * 9);

        if (sorteio.toFixed(0) == 0) {
            linkFoto = 'madara-kid.png'

        } else if (sorteio.toFixed(0) == 1) {
            linkFoto = 'madara-kid.png'

        } else if (sorteio.toFixed(0) == 2) {
            linkFoto = 'madara-edo.png'


        } else if (sorteio.toFixed(0) == 3) {
            linkFoto = 'madara-caolho.jpg'


        } else if (sorteio.toFixed(0) == 4) {
            linkFoto = 'morte.jpg'


        } else if (sorteio.toFixed(0) == 5) {
            linkFoto = 'rinnegan.jpeg'


        } else if (sorteio.toFixed(0) == 6) {
            linkFoto = 'LOUCO.png'


        } else if (sorteio.toFixed(0) == 7) {
            linkFoto = 'madara-folha.jpg'


        } else if (sorteio.toFixed(0) == 8) {
            linkFoto = 'madara-guerra.jpg'


        } else if (sorteio.toFixed(0) == 9) {
            linkFoto = 'só-madara.jpg'

        }
        console.log(linkFoto)
        console.log(sorteio)

        //foto_sorteada.innerHTML = `<img src="../Assets/${linkFoto}" alt="foto do sorteio" style="width: 300px;">`
        registrarfoto(linkFoto)

        sessionStorage.FOTO_USUARIO = linkFoto
        //  setTimeout(() => {
        // }, "2000")
        if (linkFoto != 'undefined') {
            registrarfoto()
            window.location = "../index.html";
        }
    }


    var id = sessionStorage.ID_USUARIO
    if (sessionStorage.FOTO_USUARIO == 'undefined' || sessionStorage.FOTO_USUARIO.length <= 2) {
        function registrarfoto(linkFoto) {

            id = Number(sessionStorage.ID_USUARIO);


            // Enviando o valor da nova input
            fetch("/usuarios/registrarfoto", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    // crie um atributo que recebe o valor recuperado aqui
                    // Agora vá para o arquivo routes/usuario.js
                    idServer: id,
                    linkFotoServer: linkFoto,
                })

            }).then(function (resposta) {

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));
                })


                console.log("resposta: ", resposta);

                if (resposta.ok) {
                    cardErro.style.display = "block";

                    mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                    setTimeout(() => {
                        window.location = "index-Madara.html";
                    }, "5000")

                    limparFormulario();
                    finalizarAguardar();
                } else {
                    throw ("Houve um erro ao tentar realizar o cadastro!");

                }
            }).catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
            });

        }
    }

    b_usuario.innerHTML = sessionStorage.NOME_USUARIO
    a_usuario.innerHTML = sessionStorage.NOME_USUARIO


    PegarPerfil();


    function PegarPerfil() {
        id = sessionStorage.ID_USUARIO

        linkFoto = sessionStorage
        fetch("/usuarios/fotoPerfil", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idServer: id,
            }),
        })
            .then(function (resposta) {
                if (resposta.ok) {
                    console.log(resposta);

                    resposta.json().then((json) => {
                        console.log(json);
                        console.log("Resposta" + JSON.stringify(json));

                        if (foto_fixa != 'null' && foto_fixa != 'undefined') {
                            parte1.style.display = 'none';
                            parte2.style.display = 'block';
                        } else {
                        }
                        setTimeout(function () {
                            sessionStorage.FOTO_USUARIO = json.linkFoto;
                            console.log(sessionStorage.FOTO_USUARIO);
                            frasetest.innerHTML = sessionStorage.FOTO_USUARIO;
                            suafoto.innerHTML = `<img src="../assets/${sessionStorage.FOTO_USUARIO}" alt="Foto-madara" style="width: 400px;
                             height: 400px;">`
                            //   window.location = "Perfil.html";
                            if (sessionStorage.FOTO_USUARIO != 'null' && sessionStorage.FOTO_USUARIO != 'undefined') {
                                parte1.style.display = 'none';
                                parte2.style.display = 'block';
                            } else {
                            }
                            if (sessionStorage.FOTO_USUARIO == "undefined") {
                                console.log("Ainda não tem frase");
                            } else {



                            }
                        }, 10); // apenas para exibir o loading
                    });
                } else {
                    console.log("Houve um erro ao tentar realizar o login!");
                }
            })
            .catch(function (erro) {
                console.log(erro);
            });

        return false;
    }

</script>