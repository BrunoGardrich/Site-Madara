<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styles/Perfil.css">
    <script src="../js/funcoes.js"></script>


    <title>Document</title>
</head>

<body>
    <div class="social" id="parte1" style="display: block;">
        <h1>sorteio de imagem de perfil</h1>


        Sorteie sua foto de perfil, qual fase do madara voce seria<button onclick="analisar()">Sortear</button>
        <br>
        <br>
        <div class="container">
            <ul>
                <li><a href="#img1"> <img src="../Assets/madara-kid.png" class="foto"></a></li>
                <li><a href="#img2"> <img src="../Assets/madara-edo.png" class="foto"></a></li>
                <li><a href="#img3"> <img src="../Assets/madara-caolho.jpg" class="foto"></a></li>
                <li><a href="#img4"> <img src="../Assets/morte.jpg" class="foto"></a></li>
                <li><a href="#img5"> <img src="../Assets/rinnegan.jpeg" class="foto"></a></li>
                <li><a href="#img6"> <img src="../Assets/LOUCO.png" class="foto"></a></li>
                <li><a href="#img7"> <img src="../Assets/madara-folha.jpg" class="foto"></a></li>
                <li><a href="#img8"> <img src="../Assets/madara-guerra.jpg" class="foto"></a></li>
                <li><a href="#img9"> <img src="../Assets/só-madara.jpg" class="foto"></a></li>
            </ul>
        </div>

        <div class="banner">
            <div class="hello">
                <h3>Olá, <span id="b_usuario">usuário</span>!</h3>
            </div>
            <span id="frasetest">aaaaa</span>

    </div>
    </div>

    <div class="social2" id="parte2" style="display: block;">
        <h1>Perfil</h1>
        <span id="suafoto"></span>
        <li><a href="../index.html">Ir para pagina inicial</a></li>
        <span id="frasetest"></span>

    </div>
    
</body>

</html>
<script>
    foto_fixa = sessionStorage.FOTO_USUARIO
    
    
    PegarPerfil()
    
    var linkFoto = "a"
    function analisar() {
        
        var sorteio = (Math.random() * 9);
        
        if (sorteio.toFixed(0) == 0) {
            linkFoto = 'madara-kid.png'

        } else if (sorteio.toFixed(0) == 1) {
            linkFoto = 'madara-kid.png'

        } else if (sorteio.toFixed(0) == 2) {
            linkFoto = 'madara-edo.png'


        } else if (sorteio.toFixed(0) == 3) {
            linkFoto = 'madara-caolho.jpg'


        } else if (sorteio.toFixed(0) == 4) {
            linkFoto = 'morte.jpg'


        } else if (sorteio.toFixed(0) == 5) {
            linkFoto = 'rinnegan.jpeg'


        } else if (sorteio.toFixed(0) == 6) {
            linkFoto = 'LOUCO.png'


        } else if (sorteio.toFixed(0) == 7) {
            linkFoto = 'madara-folha.jpg'


        } else if (sorteio.toFixed(0) == 8) {
            linkFoto = 'madara-guerra.jpg'


        } else if (sorteio.toFixed(0) == 9) {
            linkFoto = 'só-madara.jpg'

        }
        console.log(linkFoto)
        console.log(sorteio)

        //foto_sorteada.innerHTML = `<img src="../Assets/${linkFoto}" alt="foto do sorteio" style="width: 300px;">`
        registrarfoto(linkFoto)

        sessionStorage.FOTO_USUARIO = linkFoto
      //  setTimeout(() => {
        //    window.location = "../index.html";
       // }, "2000")
    

var id = sessionStorage.ID_USUARIO

    function registrarfoto(linkFoto) {
        
        id = Number(sessionStorage.ID_USUARIO);

        
        // Enviando o valor da nova input
        fetch("/usuarios/registrarfoto", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                idServer: id,
                linkFotoServer: linkFoto,
            })

        }).then(function (resposta) {

            resposta.json().then(json => {
                console.log(json);
                console.log(JSON.stringify(json));
            })


            console.log("resposta: ", resposta);
            
            if (resposta.ok) {
                cardErro.style.display = "block";
                
                mensagem_erro.innerHTML = "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

                setTimeout(() => {
                    //   window.location = "Login-Madara.html";
                }, "2000")

                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");

            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

    }
}
b_usuario.innerHTML = sessionStorage.NOME_USUARIO




    function PegarPerfil() {
         id = sessionStorage.ID_USUARIO
         
         linkFoto = sessionStorage
         fetch("/usuarios/fotoPerfil", {
          method: "POST",
          headers: {
              "Content-Type": "application/json",
          },
          body: JSON.stringify({
            // crie um atributo que recebe o valor recuperado aqui
            // Agora vá para o arquivo routes/usuario.js
            idServer: id,
        }),
    })
    .then(function (resposta) {
        if (resposta.ok) {
            console.log(resposta);
            
            resposta.json().then((json) => {
                console.log(json);
                console.log("Resposta" + JSON.stringify(json));
                
                if (foto_fixa != 'null' && foto_fixa != 'undefined') {
                    parte1.style.display = 'none';
                    parte2.style.display = 'block';
                } else {
                }
                setTimeout(function () {
                    sessionStorage.FOTO_USUARIO = json.linkFoto;
                    console.log(sessionStorage.FOTO_USUARIO);
                    frasetest.innerHTML = sessionStorage.FOTO_USUARIO;
                    suafoto.innerHTML= `<img src="../assets/${sessionStorage.FOTO_USUARIO}" alt="Foto-madara" style="width: 300px;">`
                 //   window.location = "Perfil.html";
                    if (sessionStorage.FOTO_USUARIO != 'null' && sessionStorage.FOTO_USUARIO != 'undefined') {
                        parte1.style.display = 'none';
                      parte2.style.display = 'block';
                  } else {
                  }
                  if (sessionStorage.FOTO_USUARIO == "undefined") {
                      console.log("Ainda não tem frase");
                    } else {
                        
                        

                  }
                }, 10); // apenas para exibir o loading
              });
            } else {
              console.log("Houve um erro ao tentar realizar o login!");
            }
          })
          .catch(function (erro) {
            console.log(erro);
          });
    
        return false;
    }
    
</script>